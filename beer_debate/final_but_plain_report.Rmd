---
title: "BEER DEBATE"
author: "John Karuitha"
date: "`r format(Sys.Date(), format = '%A %B %d, %Y')`"
subtitle: "Analyzing Consumer Ratings of Beers on BeerAdvocate.com"
output: 
  html_document:
    theme: united
    highlight: tango 
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Background
Drinkers like their beer cold. However, as is the case with all alcoholic drinks, beer is as controversial as loved. According to some estimates, global beer consumption stands at [200 million kilolitres](https://www.beveragedaily.com/Article/2021/01/04/Asia-continues-to-dominate-global-beer-consumption-Kirin) and growing. Without a doubt, brewing beer is a significant economic activity. However, detractors argue that alcohol addiction wrecks individuals and families, leading to death. But people continue to drink regardless. 

In this article, I use data from [beer advocate](https://www.beeradvocate.com/) on the ratings of beers (by the beer lovers, of course). I supplement this data with beer consumption data from [Wikipedia](https://en.wikipedia.org/wiki/List_of_countries_by_beer_consumption_per_capita).

```{r, echo = FALSE}
knitr::read_chunk("data_beer_updated.R")
```

```{r my_packages, echo = FALSE, warning=FALSE, message=FALSE}
```

```{r wiki_beer_data}
```


## Objectives

This article seeks answers to the following questions:

1. Which countries have the highest per capita beer consumption?
2. Which countries have the highest beer consumption?
2. What is the most popular beer and beer type?
2. Which brewing company brews the most popular beers in the data set.
2. Which beer categories have the highest alcohol content. 
2. Which beers have the weirdest names?
3. What factors drive beer ratings.

```{r data_scrapping_beer_advocate}
```


```{r the_data}
```

## Summary of Results

1. The Czech Republic has the highest per capita beer consumption.

2. China and the United States are the most extensive beer markets.

3. The most popular beers in the data set are `Kentucky Brunch Brand Stout`  and `Assassin - Double Barrel-Aged` by Toppling Goliath Brewing Company.

4. The most popular beer category by median ratings is `IPA - New England` followed closely by `Sour - Fruited Kettle Sour` and `Wild Ale`.

5. `Tree House Brewing Company` has the most beer brands featured in the dataset.

6. Beers made by `Anchorage Brewing Company` have the highest median rating.

7. There is no shortage when it comes to beers with weird names. Sample these:

- `A Deal with the Devil` by Anchorage Brewing Company.
- `Arrogant Bastard Ale` by Arrogant Consortia.
- `Bringing Extra Sexy Back` by Aslin Beer Company.
- `Civil Disobedience #31` by Hill Farmstead Brewery.
- `Holy Ghost` by, wait, Parish Brewing Company.
- `Sexual Chocolate` by Foothills Brewing Company - Downtown Brewpub.
- `Sweet Baby Jesus!` by DuClaw Brewing Company.
- `The Devil Made Me Do It!` by Tyranena Brewing Company.

8. The alcohol content and brewer are significant drivers of beer ratings at a 1% significance level.


```{r combined_data}

```

## The Data

As noted before, there are two sets of data. The data from `Wikipedia` has 61 rows and 5 columns of the following variables. 

- Country
- consumptionper_capita_1_litres: Per capita beer consumption in litres.
- "x2018change_litres_per_year": Change in per capita consumption from the previous year.
- total_nationalconsumption_a_million_litresper_year": Total beer consumption in millions of litres in the year. 
- Year: Indicates the year the data was collected.

```{r wiki_data_summary}
```


```{r wiki_data_summary_two}
```

The second data set comes from `beeradvocate.com`. The data has the following variables. 

- `beer`: The name of the beer.
- `votes`: The number of votes that the beer received from consumers.
- `rating_average`: The average rating from consumers. Note that the rating is on a scale of 1 to 5.
- `brewer`: The name of the brewer.
- `type`: The type of beer, for instance, lager and ale.
- `alcohol_perc`: The alcohol content.

I start by visualizing the numeric variables. The distribution of votes cast is bimodal. Again, there appears to be some positive non-linear relationship between alcohol percentage in a beer and its average rating. However, the average rating of beers skews to the left. The alcohol percentage in beers skews to the right. 

```{r numeric_variables_desc, fig.width=14, fig.height=10}

```


Next, I summarize the quantitative variables.

```{r advocate_data_summary}
```


```{r advocate_data_summary_two}
```

## Exploring the data

The data shows that the Czech Republic has the highest per capita beer consumption. It is notable that except for Namibia, an African Country, the rest of the countries with the highest per capita beer consumption are from Europe.

```{r per_capita_beer}
```

The absolute amounts of alcohol taken could be a function of the country's population and level of income. In this case, China and the United States lead in total beer consumption.

```{r total_beer_consumption}
```

Notably, Germany, Spain and Poland appear in both lists. These three countries present prime markets for beer.


# Popular Beer Brands

In this section, I examine the beers with the highest average ratings. 

```{r popular_beers}
```


It is worth noting that some of these ratings come from very few consumers. For instance, Kentucky Brunch Brand Stout received 883 votes with n average rating of 4.83, the highest rating in the data set. On the contrary, the second-highest rating beer Assassin - Double Barrel-Aged received only 17 votes with an average rating of 4.80. Beers with such few ratings may not give a fair view of consumers on the quality of a beer. 

For this reason, I filter the data only to include beers with at least 100 ratings. Kentucky Brunch Brand Stout and Vanilla Bean Assassin, both brewed by the Toppling Goliath Brewing Company, have the highest ratings of 4.83 and 4.80. 

```{r popular_beers_filtered}
```

I also visualize the number of votes that each beer has received, which is also a proxy of popularity. Breakfast Stout by Founders Brewing Company and Pliny the Elder by the Russian River Brewing Company lead the way.

```{r beers_with_most_votes}
```

## Popular Beer Types/ Categories

There are several categories of beer that each of the beers in the data belongs. Overall, there are 83 beer categories, as listed in Appendix 2. The variable `type` gives these classifications. The most common beer categories include. Note that I also filter out beers with less than 100 votes. 

I also examine beer categories that have the highest average rating. In this case, I group the data into categories and then compute the median rating. Here, `IPA - New England` and `Sour - Fruited Kettle Sour` beer categories lead with a median rating of 4.56. 

```{r most_popular_beers_categories_votes}
```

## Popular Brewers

This section examines brewers with the most beers in the dataset with at least 100 votes. Here, Tree House Brewing Company	and Founders Brewing Company lead the way with 27 beers and 17 beers, respectively, in the list. 

```{r most_popular brewers}
```

Again, I examine the median rating that the brewers receive. Anchorage Brewing Company	leads, followed by Revolution Brewing.

```{r median_rating_brewers}
```

The number of votes that beers from a given brewer receive also indicates the brewer's popularity. The table below shows the brewers whose beers have received the most votes. Founders Brewing Company, Dogfish Head Craft Brewery, and Russian River Brewing Company lead using this metric. 

```{r brewers_with_most_votes}

```

## Beers with the Highest Alcohol Content

`Samuel Adams Utopias`, a beer brewed by Boston Beer Company (Samuel Adams),	has the highest alcohol content at 28%, followed by `Black Tuesday - Reserve` made by The Bruery at 20.5%. 

```{r beers_highest_alcohol_conc}
```


## Beer Types with the Highest Median Alcohol Content

As noted before, each beer falls into a particular category represented by the variable `type` in the data set. The box plot below shows the variability in alcohol concentration for each beer type/category. 

```{r strong_beer_types2, fig.width=14, fig.height=12}
```

## Weird Beer Names

The data set has quite a number when it comes to beers with weird names. Sample these:

- `A Deal with the Devil` by Anchorage Brewing Company.
- `Arrogant Bastard Ale` by Arrogant Consortia.
- `Bringing Extra Sexy Back` by Aslin Beer Company.
- `Civil Disobedience #31` by Hill Farmstead Brewery.
- `Holy Ghost` by, wait, Parish Brewing Company.
- `Sexual Chocolate` by Foothills Brewing Company - Downtown Brewpub.
- `Sweet Baby Jesus!` by DuClaw Brewing Company.
- `The Devil Made Me Do It!` by Tyranena Brewing Company.

## Regression Analysis

### OLS Regression

Appendix 1 shows the results of the regression analysis. The dependent variable is beer ratings, while the independent variables are alcohol percentage, votes, and brewer. The result indicates that all of these variables are significant drivers of ratings. The model has an R-squared of 0.849 and an adjusted R-squared of 0.778.

```{r Regression_analysis, fig.width=14, fig.height=12}

```

The plots below will help us to evaluate the regression analysis.

```{r Plot_regression_analysis}
```

Both the residual versus actual and the QQ Plots indicate that the OLS has a good fit. The former shows no clear pattern of relationships. The former suggests that the residuals are reasonably normally distributed but with outliers. However, the model does have a significant degree of heteroscedasticity, which could indicate problems with the model, including omitted variables. As noted with the QQ plot, extreme values in the model affect the model's performance. 

However, votes have a shallow positive relationship with an average rating. Also, some of the beer brands receive very few votes. For this reason, I also run a regression with an interaction between the alcohol percentage and brewer. However, there is no significant improvement in performance. 

## Conclusion

In this article, I used data from BeerAdvocate.com and Wikipedia to examine drivers of average ratings of beer. In addition, I examined the countries with the highest beer consumption both in absolute terms and in per capita terms. The significant takeaways are as follows. 


1. The Czech Republic has the highest per capita beer consumption.

2. China and the United States are the most extensive beer markets.

3. The most popular beers  in the data set are `Kentucky Brunch Brand Stout`  and `Assassin - Double Barrel-Aged` by Toppling Goliath Brewing Company.

4. The most popular beer category by median ratings is `IPA - New England` followed closely by `Sour - Fruited Kettle Sour` and `Wild Ale`.

5. `Tree House Brewing Company` has the most brands of beer featuring in the dataset.

6. Beers made by `Anchorage Brewing Company` have the highest median rating.

7. When it comes with beers with weird names, there is no shortage. Sample these:

- `A Deal with the Devil` by Anchorage Brewing Company.
- `Arrogant Bastard Ale` by Arrogant Consortia.
- `Bringing Extra Sexy Back` by Aslin Beer Company.
- `Civil Disobedience #31` by Hill Farmstead Brewery.
- `Holy Ghost` by, wait, Parish Brewing Company.
- `Sexual Chocolate` by Foothills Brewing Company - Downtown Brewpub.
- `Sweet Baby Jesus!` by DuClaw Brewing Company.
- `The Devil Made Me Do It!` by Tyranena Brewing Company.

8. The alcohol content and brewer are significant drivers of beer ratings at 1% significance level.

## Next Steps

In the next edition, I will run several machine learning models to examine how well the model predicts beer rating. 

## Appendices

### Appendix 1: Regression analysis

```{r regression output, results='asis'}

```


### Beer Categories

```{r beer_categories}
```





